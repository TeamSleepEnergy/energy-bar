<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" http-equiv="Content-Type">
    <title>Energy Bar Home Page</title>

    <!-- Bootstrap core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap theme -->
    <link href="css/bootstrap-theme.min.css" rel="stylesheet">
    <!-- Custom side nav bar CSS -->
    <link href="css/sidenav.css" rel="stylesheet">
    <!--Energy bar css-->
    <link href="css/energy-bar.css" rel="stylesheet">
    <!-- CSS for clock -->
    <link href="css/clock.css" rel="stylesheet">
    <!-- CSS for timepicker -->
    <link href="css/bootstrap-timepicker.min.css">

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js" ></script>
    <!-- Popper (necessary for Bootstrap's Popover functionality) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="js/bootstrap.min.js"></script>
    <!-- JavaScript for side nav bar functionality -->
    <script src="js/sidenav.js"></script>
    <!-- JavaScript for clock -->
    <script src="js/clock.js"></script>
    <!-- Increase/ decrease energy bar JavaScript-->
    <script src="js/energy-bar.js"></script>
    <script src="js/alert.js"></script>
    <!-- Activate Health Effects popover -->
    <script>
        $(document).ready(function () {
            $('[rel="popover"]').popover({
                html: true,
                content: function () {
                    var content = $($(this).data('popover-content')).clone(true).removeClass(
                        'hidden');
                    return content;
                }
            }).click(function (e) {
                e.preventDefault();
            });
        });
    </script>
    <style>
    b.datapopup{
      display: none;
    }
    </style>
</head>

<body>
    <!-- Side navigation bar -->
    <div id="mySidenav" class="sidenav">
        <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
        <a href="index.html">Home</a>
        <a href="data2.html">Data</a>
        <a href="settings.html">Settings</a>
        <text> ----------------------------------------------</text>
        <a href="login.html">Log out</a>
    </div>

    <!-- Icon for side nav bar -->
    <span style="font-size:3.7em;cursor:pointer;position:absolute;top:3%;left:1.5%" onclick="openNav()">&#9776;</span>

    <!-- Display for current time, and wake-up time selection -->
    <div class="container">
        <div class="jumbotron d-flex align-items-center">
            <div id="clockbox"></div>
            <div class="div-horizontal" align="center">
                <label class="col-sm-5 control-label" for="UserInput"><i>Wake up at:</i></label>
                <div class="col-sm-3">
                    <select class="form-control input-sm" id="UserInput" autofocus>
                        <option>01:00 AM</option>
                        <option>01:30 AM</option>
                        <option>02:00 AM</option>
                        <option>02:30 AM</option>
                        <option>03:00 AM</option>
                        <option>03:30 AM</option>
                        <option>04:00 AM</option>
                        <option>04:30 AM</option>
                        <option>05:00 AM</option>
                        <option>05:30 AM</option>
                        <option>06:00 AM</option>
                        <option>06:30 AM</option>
                        <option>07:00 AM</option>
                        <option>07:30 AM</option>
                        <option>08:00 AM</option>
                        <option>08:30 AM</option>
                        <option>09:00 AM</option>
                        <option>09:30 AM</option>
                        <option>10:00 AM</option>
                        <option>10:30 AM</option>
                        <option>11:00 AM</option>
                        <option>11:30 AM</option>
                        <option>12:00 PM</option>
                        <option>12:30 PM</option>
                        <option>01:00 PM</option>
                        <option>01:30 PM</option>
                        <option>02:00 PM</option>
                        <option>02:30 PM</option>
                        <option>03:00 PM</option>
                        <option>03:30 PM</option>
                        <option>04:00 PM</option>
                        <option>04:30 PM</option>
                        <option>05:00 PM</option>
                        <option>05:30 PM</option>
                        <option>06:00 PM</option>
                        <option>06:30 PM</option>
                        <option>07:00 PM</option>
                        <option>07:30 PM</option>
                        <option>08:00 PM</option>
                        <option>08:30 PM</option>
                        <option>09:00 PM</option>
                        <option>09:30 PM</option>
                        <option>10:00 PM</option>
                        <option>10:30 PM</option>
                        <option>11:00 PM</option>
                        <option>11:30 PM</option>
                    </select>
                </div>
                <div class="col-sm-2" align="left">
                    <button id="setButton" type="button" class="btn">Set</button>
                </div>
            </div>
        </div>
    </div>

    <!--timepicker stuff-->
    <!--  <div class="input-group bootstrap-timepicker timepicker">
            <input id="timepicker1" type="text" class="form-control input-small">
            <span class="input-group-addon"><i class="glyphicon glyphicon-time"></i></span>
        </div>

        <script type="text/javascript">
            $('#timepicker1').timepicker();
        </script>
-->
  <div class ="container" align="center">
    <b id="timeRemain"><font size="2">Time Remaining:</font></b>
    &nbsp;
    &nbsp;
    <button id ="gotosleep" type="button" class="btn" onclick ="sleepytime(); savePopup(); clearNight();">Going to Sleep!</button>
    <b class="datapopup">Data Recorded!</b>
    <br></br>
    <b id="percent"><font size="2">Energy:</font></b>
      </div>
    <div class="container" align="right">
        <!-- Health eff:ects popover -->
        <a rel="popover" tabindex="0" class="btn btn-lg btn-info" role="button" data-toggle="popover" data-trigger="focus"
            data-placement="bottom" data-html="true" data-popover-content="#effects">Health Effects</a>

        <div class="hidden" id="effects">
            <ul>
                <li>Lower level of alertness</li>
                <li>Decrease in ability to concentrate on tasks</li>
                <li>Negatively impacted logical reasoning</li>
                <li>Increased stress responses</li>
            </ul>
        </div>
    </div>

    <!-- Energy bar -->
    <div class="container">
        <div align="center">
            <br>
            <br>
            <div class="col">
                <div class="progress vertical">
                    <div id="bar" class="progress-bar progress-bar-info" role="progressbar" aria-valuenow="0"
                        aria-valuemin="0" aria-valuemax="100" style="width: 0%;">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!--Energy bar related functions-->
    <script>

//'data recorded' popup
        function savePopup(){
          $(".datapopup").fadeIn();
          $(".datapopup").fadeOut();
        }
//check to see if bar is already running
        $('#setButton').click(function(){
          localStorage.setItem("running", 1);
        });

        $('#gotosleep').click(function(){
          localStorage.setItem("running", 0);
        });

        if(localStorage.getItem("running")==1){
           tRemain = setInterval(updateTime, 300);
           percRemain = setInterval(updatePercent, 300);
           interval = setInterval(initBar, 300);
        }

//record data
        function sleepytime(){
          var date = new Date();
          var hour = date.getHours();
          var min = date.getMinutes();
          var month = date.getMonth()+1;
          var day = date.getDate();
          var dropDown = document.getElementById("UserInput");
          var wakeUpString = dropDown.options[dropDown.selectedIndex].text;
          var wakeHour = Number(wakeUpString.charAt(0) + wakeUpString.charAt(1));
          var wakeMin = Number(wakeUpString.charAt(3) + wakeUpString.charAt(4));
          var pmCheck = wakeUpString.charAt(6);
          var sleptHours = 0;
          Math.abs((24 - hour) + wakeHour);
          if (pmCheck == "P" && hour != 12) {
              wakeHour += 12;
          }
          if (hour > wakeHour) {
              sleptHours = 24 - hour + wakeHour;

          } else if (hour < wakeHour) {
              sleptHours = wakeHour - hour;

          }
          var sleptMin = Math.abs((60 - min) - wakeMin);
          if (min > wakeMin) {
              var carryover = 1;
          }
           else {
              var carryover = 0;
          }
          var totalSleep = Math.round((((sleptHours - carryover) * 60 + sleptMin)/60)*10)/10;
          localStorage.setItem('hours', totalSleep);
          localStorage.setItem('day', month+"/"+day);
        }
//reset bar and info
        function clearNight(){
          $("#bar").css("width", 0 + "%")
          .attr("aria-valuenow", 0)
          document.getElementById("timeRemain").innerHTML = "Time Remaining: "
          document.getElementById("percent").innerHTML = "Energy: "
        }

//Time remaining related functions
var tRemain
        $('#setButton').click(function(){
          tRemain = setInterval(updateTime, 300);
        })

        $('#gotosleep').click(function(){
          clearInterval(tRemain);
        })

      /*  function timeInterval(){
          var tRemain = setInterval(updateTime,300);
          return tRemain;
        }

        function timeClear(){
          clearInterval(tRemain);
       }
*/
        function updateTime(){
            var date = new Date();
            var hour = date.getHours();
            var min = date.getMinutes();
            var dropDown = document.getElementById("UserInput");
            var wakeUpString = dropDown.options[dropDown.selectedIndex].text;
            var wakeHour = Number(wakeUpString.charAt(0) + wakeUpString.charAt(1));
            var wakeMin = Number(wakeUpString.charAt(3) + wakeUpString.charAt(4));
            var pmCheck = wakeUpString.charAt(6);
            var sleptHours = 0;
            Math.abs((24 - hour) + wakeHour);
            if (pmCheck == "P" && hour != 12) {
                wakeHour += 12;
            }
            if (hour > wakeHour) {
                sleptHours = 24 - hour + wakeHour;

            } else if (hour < wakeHour) {
                sleptHours = wakeHour - hour;

            }
            var sleptMin = Math.abs((60 - min) - wakeMin);
            if (min > wakeMin) {
                var carryover = 1;
            }
             else {
                var carryover = 0;
            }
            sleptHours = sleptHours - carryover;
            document.getElementById("timeRemain").innerHTML = "Time Remaining: " + sleptHours+ " hours " +sleptMin+" minutes " ;
          }


//percent related functions
var percRemain
        $('#setButton').click(function(){
           percRemain = setInterval(updatePercent, 300);
        })

        $('#gotosleep').click(function(){
          clearInterval(percRemain);
        })
/*
        function percInterval(){
           var percRemain = setInterval(updatePercent,300);
           return percRemain;
        }

        function percClear(){
          clearInterval(percRemain);
        }
*/
      function updatePercent(){
            var date = new Date();
            var hour = date.getHours();
            var min = date.getMinutes();
            var dropDown = document.getElementById("UserInput");
            var wakeUpString = dropDown.options[dropDown.selectedIndex].text;
            var wakeHour = Number(wakeUpString.charAt(0) + wakeUpString.charAt(1));
            var wakeMin = Number(wakeUpString.charAt(3) + wakeUpString.charAt(4));
            var pmCheck = wakeUpString.charAt(6);
            var sleptHours = 0;
            Math.abs((24 - hour) + wakeHour);
            if (pmCheck == "P" && hour != 12) {
                wakeHour += 12;
            }
            if (hour > wakeHour) {
                sleptHours = 24 - hour + wakeHour;

            } else if (hour < wakeHour) {
                sleptHours = wakeHour - hour;

            }
            var sleptMin = Math.abs((60 - min) - wakeMin);
            if (min > wakeMin) {
                var carryover = 1;
            }
             else {
                var carryover = 0;
            }
            var totalSleep = (sleptHours - carryover) * 60 + sleptMin;
            var current_progress = (totalSleep / (parseInt(localStorage.getItem("Hours"))*60))*100;
            document.getElementById("percent").innerHTML = "Energy: "+Math.round(current_progress*10)/10+"%";
          }


//initBar related functions
var interval;
        $('#setButton').click(function(){
          interval = setInterval(initBar, 300);
        })

        $('#gotosleep').click(function(){
          clearInterval(interval);
        })
        /*
        function barInterval(){
          var interval = setInterval(initBar,300);
          return interval;
        }

        function barClear(){
          clearInterval(interval);
        }
*/
        function initBar() {
            //id.style.width = "100%";
            //$("#bar").css("width", 100 + "%");
            //$("#bar").attr("aria-valuenow", "100");

            /*$("#bar").css("width", 100 + "%");
            $("#bar").attr("aria-valuenow", "100");*/


              var date = new Date();
              var hour = date.getHours();
              var min = date.getMinutes();
              var dropDown = document.getElementById("UserInput");
              var wakeUpString = dropDown.options[dropDown.selectedIndex].text;
              var wakeHour = Number(wakeUpString.charAt(0) + wakeUpString.charAt(1));
              var wakeMin = Number(wakeUpString.charAt(3) + wakeUpString.charAt(4));
              var pmCheck = wakeUpString.charAt(6);
              var sleptHours = 0; /*Math.abs((24 - hour) + wakeHour);*/
              if (pmCheck == "P" && hour != 12) {
                  wakeHour += 12;
              }
              if (hour > wakeHour) {
                  sleptHours = 24 - hour + wakeHour;

              } else if (hour < wakeHour) {
                  sleptHours = wakeHour - hour;

              }
              var sleptMin = Math.abs((60 - min) - wakeMin);
              if (min > wakeMin) {
                  var carryover = 1;
              } else {
                  var carryover = 0;
              }
              var totalSleep = (sleptHours - carryover) * 60 + sleptMin;
              var current_progress = (totalSleep / (parseInt(localStorage.getItem("Hours"))*60))*100;

              /*$("#bar").css("width", current_progress + "%")
                current_progress -= 1; //*/
               $("#bar").css("width", current_progress + "%")
                .attr("aria-valuenow", current_progress)
                //.text(current_progress + "% Complete");
                if (current_progress <= 0)
                    clearInterval(interval);

            } //scale this to wake up time*/

        /*       $(function () {
                    $("#bar").css("width", 100 + "%");
                    var current_progress = parseInt($("#bar").css("width")); //replace this value with val relative to time
                    var interval = setInterval(function () {
                        current_progress -= 5; //
                        $("#bar").css("width", current_progress + "%")
                        //.attr("aria-valuenow", current_progress)
                        //.text(current_progress + "% Complete");
                        /*if(current_progress <= 0)
                            clearInterval(interval);*/
        //       }, 1000); //scale this to wake up time
        //    });

        //var timeDown = setInterval(decBar, 1000);
    </script>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <!-- Popper (necessary for Bootstrap's Popover functionality) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="js/bootstrap.min.js"></script>
    <!-- JavaScript for side nav bar functionality -->
    <script src="js/sidenav.js"></script>
    <!-- Activate Health Effects popover -->
    <script>
        $(document).ready(function () {
            $('[rel="popover"]').popover({
                html: true,
                content: function () {
                    var content = $($(this).data('popover-content')).clone(true).removeClass('hidden');
                    return content;
                }
            }).click(function (e) {
                e.preventDefault();
            });
        });
    </script>
</body>

</html>
